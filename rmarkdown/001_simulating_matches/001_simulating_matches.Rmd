---
title: "How good do you have to be to win a tennis match?"
date: "March 2022"
output: 
  html_document:
    theme: united
---

```{r,include=FALSE}
# This is needed to set the directory for all subsequent chunks
knitr::opts_knit$set(root.dir = '/Users/williammunn/Documents/github/tennis/functions/')
```

```{r,include=FALSE}
library(data.table)
library(ggplot2)
library(scales)
source("simulate_match.R")
#source("/Users/williammunn/Documents/github/tennis/rmarkdown/001_simulating_matches/001_simulating_matches.R",local = knitr::knit_global())
```

### The good, the bad, and the ugly

At the Monte Carlo Masters in 2017, Diego Schwartzman managed a victory over Roberto Bautista Agut, despite winning only 48% of his own points on serve. To claim so few points on your own serve would typically seal your fate in a professional tennis match. However, offsetting this was some incredible returning that saw him take 62% of points on his spanish rival's own serve.

At the other end of the spectrum: in 2019, at the New York Open, Reilly Opelka eventually edged out his compatriot John Isner. Unsurprisingly, given a match up between the two, the match was completely serve dominated (this occasion saw the Americans shatter the record for most aces in a best of three match, with a combined total of 81). In fact, despite winning 80% of his own service points, Isner could only manage a paltry 13% of points won on return (compared with Opelka's still-laughable 19%).

Matches like these two are extreme cases - and indeed, the tour average since 2010 for winners has been 69%/42% for serve and return points won - but they do suggest that, in order to win a tennis match, your combined serving and returning performance needs to be *good*. But how good is good enough?

### Playing tennis matches using R

Here are some R functions I've developed that will help.

The first is `play.point()`, which takes in a the name of the server (needs to be either "P1" or "P2"), and the average percentage of points that player wins on their serve. We could "simulate" a single point from Isner in his match above like this:

```{r}
play.point("P1",0.8)
```

The `play.point()` functions depends on a random number being drawn each time it gets invoked. So, while our R version of  Isner will still lose the odd point, he should, on average, win on his serve four out of five times. A larger number of simulations shows this:

```{r}
# show that play.point is eventually right
outcomes <- sapply(1:10000, function(x) play.point("P1",0.8))
win_percent <- sum(outcomes == "P1")/length(outcomes)
percent(win_percent)
```
